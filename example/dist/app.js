require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var React = require('react'),
  Autosuggest = require('../../src/Autosuggest.jsx');

var App = React.createClass({displayName: "App",
  /**
   * Render the example app
   */
  render: function() {
    var fixtures = [
      {label: 'New York', location: {lat: 40.7033127, lng: -73.979681}},
      {label: 'Rio', location: {lat: -22.066452, lng: -42.9232368}},
      {label: 'Tokyo', location: {lat: 35.673343, lng: 139.710388}}
    ];

    return (
      React.createElement("div", null, 
        React.createElement(Autosuggest, {
          fixtures: fixtures, 
          onSuggestSelect: this.onSuggestSelect, 
          location: new google.maps.LatLng(53.558572, 9.9278215), 
          radius: "20"})
      )
    );
  },

  /**
   * When a suggest got selected
   * @param  {Object} suggest The suggest
   */
  onSuggestSelect: function(suggest) {
    console.log(suggest);
  }
});

React.render(React.createElement(App, null), document.getElementById('app'));


},{"../../src/Autosuggest.jsx":2,"react":undefined}],2:[function(require,module,exports){
var React = require('react'),
  AutosuggestItem = require('./AutosuggestItem.jsx'),
  superagent = require("superagent");

var Autosuggest = React.createClass({displayName: "Autosuggest",
  /**
   * Get the default props
   * @return {Object} The state
   */
  getDefaultProps: function() {
    return {
      fixtures: [],
      placeholder: 'Search',
      onSuggestSelect: function() {},
      location: null,
      radius: 0
    };
  },

  /**
   * Get the initial state
   * @return {Object} The state
   */
  getInitialState: function() {
    return {
      isSuggestsHidden: true,
      userInput: '',
      activeSuggest: null,
      suggests: [],
      autocoder: new google.maps.Geocoder(),
      autocompleteService: new google.maps.places.AutocompleteService()
    };
  },

  /**
   * When the input got changed
   */
  onInputChange: function() {
    var userInput = this.refs.autosuggestInput.getDOMNode().value;

    this.setState({userInput: userInput}, function() {
      if (!userInput) {
        this.updateSuggests();
      }
    }.bind(this));

    if (!userInput) {
      return;
    }

    this.state.autocompleteService.getPlacePredictions({
      input: userInput,
      location: this.props.location || new google.maps.LatLng(0, 0),
      radius: this.props.radius
    }, function(suggestsGoogle) {
      this.updateSuggests(suggestsGoogle);
    }.bind(this));
  },

  /**
   * Update the suggests
   * @param  {Object} suggestsGoogle The new google suggests
   */
  updateSuggests: function(suggestsGoogle) {
    if (!suggestsGoogle) {
      suggestsGoogle = [];
    }

    var suggests = [],
      regex = new RegExp(this.state.userInput, 'gim'),
      suggestItems;

    this.props.fixtures.forEach(function(suggest) {
      if (suggest.label.match(regex)) {
        suggest.placeId = suggest.label;
        suggests.push(suggest);
      }
    }.bind(this));

    suggestsGoogle.forEach(function(suggest) {
      suggests.push({
        label: suggest.description,
        placeId: suggest.place_id
      });
    }.bind(this));

    this.setState({suggests: suggests});
  },

  /**
   * When the input gets focused
   * @param  {Event} event The focus event
   */
  showSuggests: function(event) {
    this.updateSuggests();

    this.setState({isSuggestsHidden: false});
  },

  /**
   * When the input loses focused
   * @param  {Event} event The focus event
   */
  hideSuggests: function(event) {
    setTimeout(function() {
      this.setState({isSuggestsHidden: true});
    }.bind(this), 100);
  },

  /**
   * When a key gets pressed in the input
   * @param  {Event} event The keypress event
   */
  onInputKeyDown: function(event) {
    switch (event.which) {
      case 40: // DOWN
        event.preventDefault();
        this.activateSuggest('next');
        break;
      case 38: // UP
        event.preventDefault();
        this.activateSuggest('prev');
        break;
      case 13: // ENTER
        this.selectSuggest(this.state.activeSuggest);
        break;
      case 9: // TAB
        this.selectSuggest(this.state.activeSuggest);
        break;
      case 27: // ESC
        this.hideSuggests();
        break;
    }
  },

  /**
   * Activate a new suggest
   * @param {String} direction The direction in which to activate new suggest
   */
  activateSuggest: function(direction) {
    var suggestsCount = this.state.suggests.length - 1,
      next = direction === ('next'),
      newActiveSuggest = null,
      newIndex = 0,
      i = 0;

    for (i; i <= suggestsCount; i++) {
      if (this.state.suggests[i] === this.state.activeSuggest) {
        newIndex = next ? i + 1 : i - 1;
      }
    }

    if (!this.state.activeSuggest) {
      newIndex = next ? 0 : suggestsCount;
    }

    if (newIndex >= 0 && newIndex <= suggestsCount) {
      newActiveSuggest = this.state.suggests[newIndex];
    }

    this.setState({activeSuggest: newActiveSuggest});
  },

  /**
   * When an item got selected
   * @param {AutosuggestItem} suggest The selected suggest item
   */
  selectSuggest: function(suggest) {
    if (!suggest) {
      suggest = {
        label: this.state.userInput
      };
    }

    this.setState({
      isSuggestsHidden: true,
      userInput: suggest.label
    });

    if (suggest.location) {
      this.props.onSuggestSelect(suggest);
      return;
    }

    this.autocodeSuggest(suggest);
  },

  /**
   * autocode a suggest
   * @param  {Object} suggest The suggest
   */
  autocodeSuggest: function(suggest) {
    var location;

    this.state.autocoder.autocode(
      {address: suggest.label},
      function(results, status) {
        if (status !== google.maps.GeocoderStatus.OK) {
          return;
        }

        location = results[0].geometry.location;

        suggest.location = {
          lat: location.lat(),
          lng: location.lng()
        };

        this.props.onSuggestSelect(suggest);
      }.bind(this)
    );
  },

  /**
   * Render the view
   */
  render: function() {
    return (
      React.createElement("div", {className: "autosuggest", onClick: this.onClick}, 
        React.createElement("input", {
          className: "autosuggest__input", 
          ref: "autosuggestInput", 
          type: "text", 
          value: this.state.userInput, 
          placeholder: this.props.placeholder, 
          onKeyDown: this.onInputKeyDown, 
          onChange: this.onInputChange, 
          onFocus: this.showSuggests, 
          onBlur: this.hideSuggests}), 
        React.createElement("ul", {className: this.getSuggestsClasses()}, 
          this.getSuggestItems()
        )
      )
    );
  },

  /**
   * Get the suggest items for the list
   * @return {Array} The suggestions
   */
  getSuggestItems: function() {
    return this.state.suggests.map(function(suggest) {
      var isActive = (this.state.activeSuggest &&
        suggest.placeId === this.state.activeSuggest.placeId);

      return (
        React.createElement(AutosuggestItem, {
          key: suggest.placeId, 
          suggest: suggest, 
          isActive: isActive, 
          onSuggestSelect: this.selectSuggest})
      );
    }.bind(this));
  },

  /**
   * The classes for the suggests list
   * @return {String} The classes
   */
  getSuggestsClasses: function() {
    var classes = 'autosuggest__suggests'

    classes += this.state.isSuggestsHidden ?
      ' autosuggest__suggests--hidden' : '';

    return classes;
  }
});

module.exports = Autosuggest;


},{"./AutosuggestItem.jsx":3,"react":undefined,"superagent":undefined}],3:[function(require,module,exports){
var React = require('react');

var AutosuggestItem = React.createClass({displayName: "AutosuggestItem",
  /**
   * Get the default props
   * @return {Object} The props
   */
  getDefaultProps: function() {
    return {
      isActive: false,
      suggest: {
        label: ''
      },
      onSuggestSelect: function() {}
    };
  },

  /**
   * When the element gets clicked
   * @param  {Event} event The click event
   */
  onClick: function(event) {
    event.preventDefault();
    this.props.onSuggestSelect(this.props.suggest);
  },

  /**
   * Render the view
   */
  render: function() {
    return (
      React.createElement("li", {className: this.getSuggestClasses(), 
        onClick: this.onClick}, 
          this.props.suggest.label
      )
    );
  },

  /**
   * The classes for the suggest item
   * @return {String} The classes
   */
  getSuggestClasses: function() {
    var classes = 'autosuggest-item';

    classes += this.props.isActive ? ' autosuggest-item--active' : '';

    return classes;
  }
});

module.exports = AutosuggestItem;


},{"react":undefined}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9yZWFjdC1jb21wb25lbnQtZ3VscC10YXNrcy9ub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwiL2hvbWUvaGFyaWJhYnV2aXN3YW5hdGgvcmVhY3QtYXV0b3N1Z2dlc3QvZXhhbXBsZS9zcmMvYXBwLmpzIiwiL2hvbWUvaGFyaWJhYnV2aXN3YW5hdGgvcmVhY3QtYXV0b3N1Z2dlc3Qvc3JjL0F1dG9zdWdnZXN0LmpzeCIsIi9ob21lL2hhcmliYWJ1dmlzd2FuYXRoL3JlYWN0LWF1dG9zdWdnZXN0L3NyYy9BdXRvc3VnZ2VzdEl0ZW0uanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQztBQUM1QixFQUFFLFdBQVcsR0FBRyxPQUFPLENBQUMsMkJBQTJCLENBQUMsQ0FBQzs7QUFFckQsSUFBSSx5QkFBeUIsbUJBQUE7QUFDN0I7QUFDQTs7RUFFRSxNQUFNLEVBQUUsV0FBVztJQUNqQixJQUFJLFFBQVEsR0FBRztNQUNiLENBQUMsS0FBSyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsQ0FBQyxHQUFHLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO01BQ2pFLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUM7TUFDN0QsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxDQUFDLEdBQUcsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0FBQ25FLEtBQUssQ0FBQzs7SUFFRjtNQUNFLG9CQUFBLEtBQUksRUFBQSxJQUFDLEVBQUE7UUFDSCxvQkFBQyxXQUFXLEVBQUEsQ0FBQTtVQUNWLFFBQUEsRUFBUSxD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O0lBRWxFLE9BQU8sT0FBTyxDQUFDO0dBQ2hCO0FBQ0gsQ0FBQyxDQUFDLENBQUM7O0FBRUgsTUFBTSxDQUFDLE9BQU8sR0FBRyxlQUFlLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKSxcbiAgQXV0b3N1Z2dlc3QgPSByZXF1aXJlKCcuLi8uLi9zcmMvQXV0b3N1Z2dlc3QuanN4Jyk7XG5cbnZhciBBcHAgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gIC8qKlxuICAgKiBSZW5kZXIgdGhlIGV4YW1wbGUgYXBwXG4gICAqL1xuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBmaXh0dXJlcyA9IFtcbiAgICAgIHtsYWJlbDogJ05ldyBZb3JrJywgbG9jYXRpb246IHtsYXQ6IDQwLjcwMzMxMjcsIGxuZzogLTczLjk3OTY4MX19LFxuICAgICAge2xhYmVsOiAnUmlvJywgbG9jYXRpb246IHtsYXQ6IC0yMi4wNjY0NTIsIGxuZzogLTQyLjkyMzIzNjh9fSxcbiAgICAgIHtsYWJlbDogJ1Rva3lvJywgbG9jYXRpb246IHtsYXQ6IDM1LjY3MzM0MywgbG5nOiAxMzkuNzEwMzg4fX1cbiAgICBdO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXY+XG4gICAgICAgIDxBdXRvc3VnZ2VzdFxuICAgICAgICAgIGZpeHR1cmVzPXtmaXh0dXJlc31cbiAgICAgICAgICBvblN1Z2dlc3RTZWxlY3Q9e3RoaXMub25TdWdnZXN0U2VsZWN0fVxuICAgICAgICAgIGxvY2F0aW9uPXtuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDUzLjU1ODU3MiwgOS45Mjc4MjE1KX1cbiAgICAgICAgICByYWRpdXM9XCIyMFwiIC8+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9LFxuXG4gIC8qKlxuICAgKiBXaGVuIGEgc3VnZ2VzdCBnb3Qgc2VsZWN0ZWRcbiAgICogQHBhcmFtICB7T2JqZWN0fSBzdWdnZXN0IFRoZSBzdWdnZXN0XG4gICAqL1xuICBvblN1Z2dlc3RTZWxlY3Q6IGZ1bmN0aW9uKHN1Z2dlc3QpIHtcbiAgICBjb25zb2xlLmxvZyhzdWdnZXN0KTtcbiAgfVxufSk7XG5cblJlYWN0LnJlbmRlcig8QXBwIC8+LCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBwJykpO1xuIiwidmFyIFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKSxcbiAgQXV0b3N1Z2dlc3RJdGVtID0gcmVxdWlyZSgnLi9BdXRvc3VnZ2VzdEl0ZW0uanN4JyksXG4gIHN1cGVyYWdlbnQgPSByZXF1aXJlKFwic3VwZXJhZ2VudFwiKTtcblxudmFyIEF1dG9zdWdnZXN0ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAvKipcbiAgICogR2V0IHRoZSBkZWZhdWx0IHByb3BzXG4gICAqIEByZXR1cm4ge09iamVjdH0gVGhlIHN0YXRlXG4gICAqL1xuICBnZXREZWZhdWx0UHJvcHM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICBmaXh0dXJlczogW10sXG4gICAgICBwbGFjZWhvbGRlcjogJ1NlYXJjaCcsXG4gICAgICBvblN1Z2dlc3RTZWxlY3Q6IGZ1bmN0aW9uKCkge30sXG4gICAgICBsb2NhdGlvbjogbnVsbCxcbiAgICAgIHJhZGl1czogMFxuICAgIH07XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldCB0aGUgaW5pdGlhbCBzdGF0ZVxuICAgKiBAcmV0dXJuIHtPYmplY3R9IFRoZSBzdGF0ZVxuICAgKi9cbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaXNTdWdnZXN0c0hpZGRlbjogdHJ1ZSxcbiAgICAgIHVzZXJJbnB1dDogJycsXG4gICAgICBhY3RpdmVTdWdnZXN0OiBudWxsLFxuICAgICAgc3VnZ2VzdHM6IFtdLFxuICAgICAgYXV0b2NvZGVyOiBuZXcgZ29vZ2xlLm1hcHMuR2VvY29kZXIoKSxcbiAgICAgIGF1dG9jb21wbGV0ZVNlcnZpY2U6IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuQXV0b2NvbXBsZXRlU2VydmljZSgpXG4gICAgfTtcbiAgfSxcblxuICAvKipcbiAgICogV2hlbiB0aGUgaW5wdXQgZ290IGNoYW5nZWRcbiAgICovXG4gIG9uSW5wdXRDaGFuZ2U6IGZ1bmN0aW9uKCkge1xuICAgIHZhciB1c2VySW5wdXQgPSB0aGlzLnJlZnMuYXV0b3N1Z2dlc3RJbnB1dC5nZXRET01Ob2RlKCkudmFsdWU7XG5cbiAgICB0aGlzLnNldFN0YXRlKHt1c2VySW5wdXQ6IHVzZXJJbnB1dH0sIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCF1c2VySW5wdXQpIHtcbiAgICAgICAgdGhpcy51cGRhdGVTdWdnZXN0cygpO1xuICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICBpZiAoIXVzZXJJbnB1dCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuc3RhdGUuYXV0b2NvbXBsZXRlU2VydmljZS5nZXRQbGFjZVByZWRpY3Rpb25zKHtcbiAgICAgIGlucHV0OiB1c2VySW5wdXQsXG4gICAgICBsb2NhdGlvbjogdGhpcy5wcm9wcy5sb2NhdGlvbiB8fCBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDAsIDApLFxuICAgICAgcmFkaXVzOiB0aGlzLnByb3BzLnJhZGl1c1xuICAgIH0sIGZ1bmN0aW9uKHN1Z2dlc3RzR29vZ2xlKSB7XG4gICAgICB0aGlzLnVwZGF0ZVN1Z2dlc3RzKHN1Z2dlc3RzR29vZ2xlKTtcbiAgICB9LmJpbmQodGhpcykpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHN1Z2dlc3RzXG4gICAqIEBwYXJhbSAge09iamVjdH0gc3VnZ2VzdHNHb29nbGUgVGhlIG5ldyBnb29nbGUgc3VnZ2VzdHNcbiAgICovXG4gIHVwZGF0ZVN1Z2dlc3RzOiBmdW5jdGlvbihzdWdnZXN0c0dvb2dsZSkge1xuICAgIGlmICghc3VnZ2VzdHNHb29nbGUpIHtcbiAgICAgIHN1Z2dlc3RzR29vZ2xlID0gW107XG4gICAgfVxuXG4gICAgdmFyIHN1Z2dlc3RzID0gW10sXG4gICAgICByZWdleCA9IG5ldyBSZWdFeHAodGhpcy5zdGF0ZS51c2VySW5wdXQsICdnaW0nKSxcbiAgICAgIHN1Z2dlc3RJdGVtcztcblxuICAgIHRoaXMucHJvcHMuZml4dHVyZXMuZm9yRWFjaChmdW5jdGlvbihzdWdnZXN0KSB7XG4gICAgICBpZiAoc3VnZ2VzdC5sYWJlbC5tYXRjaChyZWdleCkpIHtcbiAgICAgICAgc3VnZ2VzdC5wbGFjZUlkID0gc3VnZ2VzdC5sYWJlbDtcbiAgICAgICAgc3VnZ2VzdHMucHVzaChzdWdnZXN0KTtcbiAgICAgIH1cbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgc3VnZ2VzdHNHb29nbGUuZm9yRWFjaChmdW5jdGlvbihzdWdnZXN0KSB7XG4gICAgICBzdWdnZXN0cy5wdXNoKHtcbiAgICAgICAgbGFiZWw6IHN1Z2dlc3QuZGVzY3JpcHRpb24sXG4gICAgICAgIHBsYWNlSWQ6IHN1Z2dlc3QucGxhY2VfaWRcbiAgICAgIH0pO1xuICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICB0aGlzLnNldFN0YXRlKHtzdWdnZXN0czogc3VnZ2VzdHN9KTtcbiAgfSxcblxuICAvKipcbiAgICogV2hlbiB0aGUgaW5wdXQgZ2V0cyBmb2N1c2VkXG4gICAqIEBwYXJhbSAge0V2ZW50fSBldmVudCBUaGUgZm9jdXMgZXZlbnRcbiAgICovXG4gIHNob3dTdWdnZXN0czogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB0aGlzLnVwZGF0ZVN1Z2dlc3RzKCk7XG5cbiAgICB0aGlzLnNldFN0YXRlKHtpc1N1Z2dlc3RzSGlkZGVuOiBmYWxzZX0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBXaGVuIHRoZSBpbnB1dCBsb3NlcyBmb2N1c2VkXG4gICAqIEBwYXJhbSAge0V2ZW50fSBldmVudCBUaGUgZm9jdXMgZXZlbnRcbiAgICovXG4gIGhpZGVTdWdnZXN0czogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7aXNTdWdnZXN0c0hpZGRlbjogdHJ1ZX0pO1xuICAgIH0uYmluZCh0aGlzKSwgMTAwKTtcbiAgfSxcblxuICAvKipcbiAgICogV2hlbiBhIGtleSBnZXRzIHByZXNzZWQgaW4gdGhlIGlucHV0XG4gICAqIEBwYXJhbSAge0V2ZW50fSBldmVudCBUaGUga2V5cHJlc3MgZXZlbnRcbiAgICovXG4gIG9uSW5wdXRLZXlEb3duOiBmdW5jdGlvbihldmVudCkge1xuICAgIHN3aXRjaCAoZXZlbnQud2hpY2gpIHtcbiAgICAgIGNhc2UgNDA6IC8vIERPV05cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5hY3RpdmF0ZVN1Z2dlc3QoJ25leHQnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM4OiAvLyBVUFxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLmFjdGl2YXRlU3VnZ2VzdCgncHJldicpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMTM6IC8vIEVOVEVSXG4gICAgICAgIHRoaXMuc2VsZWN0U3VnZ2VzdCh0aGlzLnN0YXRlLmFjdGl2ZVN1Z2dlc3QpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgOTogLy8gVEFCXG4gICAgICAgIHRoaXMuc2VsZWN0U3VnZ2VzdCh0aGlzLnN0YXRlLmFjdGl2ZVN1Z2dlc3QpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjc6IC8vIEVTQ1xuICAgICAgICB0aGlzLmhpZGVTdWdnZXN0cygpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIEFjdGl2YXRlIGEgbmV3IHN1Z2dlc3RcbiAgICogQHBhcmFtIHtTdHJpbmd9IGRpcmVjdGlvbiBUaGUgZGlyZWN0aW9uIGluIHdoaWNoIHRvIGFjdGl2YXRlIG5ldyBzdWdnZXN0XG4gICAqL1xuICBhY3RpdmF0ZVN1Z2dlc3Q6IGZ1bmN0aW9uKGRpcmVjdGlvbikge1xuICAgIHZhciBzdWdnZXN0c0NvdW50ID0gdGhpcy5zdGF0ZS5zdWdnZXN0cy5sZW5ndGggLSAxLFxuICAgICAgbmV4dCA9IGRpcmVjdGlvbiA9PT0gKCduZXh0JyksXG4gICAgICBuZXdBY3RpdmVTdWdnZXN0ID0gbnVsbCxcbiAgICAgIG5ld0luZGV4ID0gMCxcbiAgICAgIGkgPSAwO1xuXG4gICAgZm9yIChpOyBpIDw9IHN1Z2dlc3RzQ291bnQ7IGkrKykge1xuICAgICAgaWYgKHRoaXMuc3RhdGUuc3VnZ2VzdHNbaV0gPT09IHRoaXMuc3RhdGUuYWN0aXZlU3VnZ2VzdCkge1xuICAgICAgICBuZXdJbmRleCA9IG5leHQgPyBpICsgMSA6IGkgLSAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghdGhpcy5zdGF0ZS5hY3RpdmVTdWdnZXN0KSB7XG4gICAgICBuZXdJbmRleCA9IG5leHQgPyAwIDogc3VnZ2VzdHNDb3VudDtcbiAgICB9XG5cbiAgICBpZiAobmV3SW5kZXggPj0gMCAmJiBuZXdJbmRleCA8PSBzdWdnZXN0c0NvdW50KSB7XG4gICAgICBuZXdBY3RpdmVTdWdnZXN0ID0gdGhpcy5zdGF0ZS5zdWdnZXN0c1tuZXdJbmRleF07XG4gICAgfVxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7YWN0aXZlU3VnZ2VzdDogbmV3QWN0aXZlU3VnZ2VzdH0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBXaGVuIGFuIGl0ZW0gZ290IHNlbGVjdGVkXG4gICAqIEBwYXJhbSB7QXV0b3N1Z2dlc3RJdGVtfSBzdWdnZXN0IFRoZSBzZWxlY3RlZCBzdWdnZXN0IGl0ZW1cbiAgICovXG4gIHNlbGVjdFN1Z2dlc3Q6IGZ1bmN0aW9uKHN1Z2dlc3QpIHtcbiAgICBpZiAoIXN1Z2dlc3QpIHtcbiAgICAgIHN1Z2dlc3QgPSB7XG4gICAgICAgIGxhYmVsOiB0aGlzLnN0YXRlLnVzZXJJbnB1dFxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGlzU3VnZ2VzdHNIaWRkZW46IHRydWUsXG4gICAgICB1c2VySW5wdXQ6IHN1Z2dlc3QubGFiZWxcbiAgICB9KTtcblxuICAgIGlmIChzdWdnZXN0LmxvY2F0aW9uKSB7XG4gICAgICB0aGlzLnByb3BzLm9uU3VnZ2VzdFNlbGVjdChzdWdnZXN0KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmF1dG9jb2RlU3VnZ2VzdChzdWdnZXN0KTtcbiAgfSxcblxuICAvKipcbiAgICogYXV0b2NvZGUgYSBzdWdnZXN0XG4gICAqIEBwYXJhbSAge09iamVjdH0gc3VnZ2VzdCBUaGUgc3VnZ2VzdFxuICAgKi9cbiAgYXV0b2NvZGVTdWdnZXN0OiBmdW5jdGlvbihzdWdnZXN0KSB7XG4gICAgdmFyIGxvY2F0aW9uO1xuXG4gICAgdGhpcy5zdGF0ZS5hdXRvY29kZXIuYXV0b2NvZGUoXG4gICAgICB7YWRkcmVzczogc3VnZ2VzdC5sYWJlbH0sXG4gICAgICBmdW5jdGlvbihyZXN1bHRzLCBzdGF0dXMpIHtcbiAgICAgICAgaWYgKHN0YXR1cyAhPT0gZ29vZ2xlLm1hcHMuR2VvY29kZXJTdGF0dXMuT0spIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBsb2NhdGlvbiA9IHJlc3VsdHNbMF0uZ2VvbWV0cnkubG9jYXRpb247XG5cbiAgICAgICAgc3VnZ2VzdC5sb2NhdGlvbiA9IHtcbiAgICAgICAgICBsYXQ6IGxvY2F0aW9uLmxhdCgpLFxuICAgICAgICAgIGxuZzogbG9jYXRpb24ubG5nKClcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnByb3BzLm9uU3VnZ2VzdFNlbGVjdChzdWdnZXN0KTtcbiAgICAgIH0uYmluZCh0aGlzKVxuICAgICk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJlbmRlciB0aGUgdmlld1xuICAgKi9cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJhdXRvc3VnZ2VzdFwiIG9uQ2xpY2s9e3RoaXMub25DbGlja30+XG4gICAgICAgIDxpbnB1dFxuICAgICAgICAgIGNsYXNzTmFtZT1cImF1dG9zdWdnZXN0X19pbnB1dFwiXG4gICAgICAgICAgcmVmPVwiYXV0b3N1Z2dlc3RJbnB1dFwiXG4gICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLnVzZXJJbnB1dH1cbiAgICAgICAgICBwbGFjZWhvbGRlcj17dGhpcy5wcm9wcy5wbGFjZWhvbGRlcn1cbiAgICAgICAgICBvbktleURvd249e3RoaXMub25JbnB1dEtleURvd259XG4gICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25JbnB1dENoYW5nZX1cbiAgICAgICAgICBvbkZvY3VzPXt0aGlzLnNob3dTdWdnZXN0c31cbiAgICAgICAgICBvbkJsdXI9e3RoaXMuaGlkZVN1Z2dlc3RzfSAvPlxuICAgICAgICA8dWwgY2xhc3NOYW1lPXt0aGlzLmdldFN1Z2dlc3RzQ2xhc3NlcygpfT5cbiAgICAgICAgICB7dGhpcy5nZXRTdWdnZXN0SXRlbXMoKX1cbiAgICAgICAgPC91bD5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldCB0aGUgc3VnZ2VzdCBpdGVtcyBmb3IgdGhlIGxpc3RcbiAgICogQHJldHVybiB7QXJyYXl9IFRoZSBzdWdnZXN0aW9uc1xuICAgKi9cbiAgZ2V0U3VnZ2VzdEl0ZW1zOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZS5zdWdnZXN0cy5tYXAoZnVuY3Rpb24oc3VnZ2VzdCkge1xuICAgICAgdmFyIGlzQWN0aXZlID0gKHRoaXMuc3RhdGUuYWN0aXZlU3VnZ2VzdCAmJlxuICAgICAgICBzdWdnZXN0LnBsYWNlSWQgPT09IHRoaXMuc3RhdGUuYWN0aXZlU3VnZ2VzdC5wbGFjZUlkKTtcblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPEF1dG9zdWdnZXN0SXRlbVxuICAgICAgICAgIGtleT17c3VnZ2VzdC5wbGFjZUlkfVxuICAgICAgICAgIHN1Z2dlc3Q9e3N1Z2dlc3R9XG4gICAgICAgICAgaXNBY3RpdmU9e2lzQWN0aXZlfVxuICAgICAgICAgIG9uU3VnZ2VzdFNlbGVjdD17dGhpcy5zZWxlY3RTdWdnZXN0fSAvPlxuICAgICAgKTtcbiAgICB9LmJpbmQodGhpcykpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBUaGUgY2xhc3NlcyBmb3IgdGhlIHN1Z2dlc3RzIGxpc3RcbiAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgY2xhc3Nlc1xuICAgKi9cbiAgZ2V0U3VnZ2VzdHNDbGFzc2VzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgY2xhc3NlcyA9ICdhdXRvc3VnZ2VzdF9fc3VnZ2VzdHMnXG5cbiAgICBjbGFzc2VzICs9IHRoaXMuc3RhdGUuaXNTdWdnZXN0c0hpZGRlbiA/XG4gICAgICAnIGF1dG9zdWdnZXN0X19zdWdnZXN0cy0taGlkZGVuJyA6ICcnO1xuXG4gICAgcmV0dXJuIGNsYXNzZXM7XG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEF1dG9zdWdnZXN0O1xuIiwidmFyIFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxudmFyIEF1dG9zdWdnZXN0SXRlbSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgLyoqXG4gICAqIEdldCB0aGUgZGVmYXVsdCBwcm9wc1xuICAgKiBAcmV0dXJuIHtPYmplY3R9IFRoZSBwcm9wc1xuICAgKi9cbiAgZ2V0RGVmYXVsdFByb3BzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgICAgc3VnZ2VzdDoge1xuICAgICAgICBsYWJlbDogJydcbiAgICAgIH0sXG4gICAgICBvblN1Z2dlc3RTZWxlY3Q6IGZ1bmN0aW9uKCkge31cbiAgICB9O1xuICB9LFxuXG4gIC8qKlxuICAgKiBXaGVuIHRoZSBlbGVtZW50IGdldHMgY2xpY2tlZFxuICAgKiBAcGFyYW0gIHtFdmVudH0gZXZlbnQgVGhlIGNsaWNrIGV2ZW50XG4gICAqL1xuICBvbkNsaWNrOiBmdW5jdGlvbihldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgdGhpcy5wcm9wcy5vblN1Z2dlc3RTZWxlY3QodGhpcy5wcm9wcy5zdWdnZXN0KTtcbiAgfSxcblxuICAvKipcbiAgICogUmVuZGVyIHRoZSB2aWV3XG4gICAqL1xuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8bGkgY2xhc3NOYW1lPXt0aGlzLmdldFN1Z2dlc3RDbGFzc2VzKCl9XG4gICAgICAgIG9uQ2xpY2s9e3RoaXMub25DbGlja30+XG4gICAgICAgICAge3RoaXMucHJvcHMuc3VnZ2VzdC5sYWJlbH1cbiAgICAgIDwvbGk+XG4gICAgKTtcbiAgfSxcblxuICAvKipcbiAgICogVGhlIGNsYXNzZXMgZm9yIHRoZSBzdWdnZXN0IGl0ZW1cbiAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgY2xhc3Nlc1xuICAgKi9cbiAgZ2V0U3VnZ2VzdENsYXNzZXM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjbGFzc2VzID0gJ2F1dG9zdWdnZXN0LWl0ZW0nO1xuXG4gICAgY2xhc3NlcyArPSB0aGlzLnByb3BzLmlzQWN0aXZlID8gJyBhdXRvc3VnZ2VzdC1pdGVtLS1hY3RpdmUnIDogJyc7XG5cbiAgICByZXR1cm4gY2xhc3NlcztcbiAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQXV0b3N1Z2dlc3RJdGVtO1xuIl19
